parameters:
  name: ''
  buildScript: ''
  queue: {}

phases:
  - phase: ${{ parameters.name }}
    variables:
      _buildScript: ${{ parameters.buildScript }}
      _phaseName: ${{ parameters.name }}
    queue:
      parallel: 2
      matrix:
        Build_Debug:
          _configuration: Debug
        Build_Release:
          _configuration: Release 
      ${{ insert }}: ${{ parameters.queue }}
    steps:
    - script: $(_buildScript) -$(_configuration) -runtests
      displayName: Build and Test
    - task: PublishTestResults@2
      displayName: Publish Test Results
      condition: succeededOrFailed()
      inputs:
        testRunner: 'vSTest'
        testResultsFiles: '**/*.trx'
        testRunTitle: Machinelearning_Tests_$(_phaseName)_$(_configuration)_$(Build.BuildNumber)
        configuration: $(_configuration)
    - script: $(_buildScript) -buildPackages
      displayName: Build Packages
